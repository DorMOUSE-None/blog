<!DOCTYPE html><html><head><meta charSet="utf-8" class="next-head"/><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" class="next-head"/><link rel="preload" href="https://www.ffutop.com/blog/_next/static/YsOqVyLvFnUbWFBFmGa7N/pages/index.js" as="script"/><link rel="preload" href="https://www.ffutop.com/blog/_next/static/YsOqVyLvFnUbWFBFmGa7N/pages/_app.js" as="script"/><link rel="preload" href="https://www.ffutop.com/blog/_next/static/runtime/webpack-8ed9452df514b4d17d80.js" as="script"/><link rel="preload" href="https://www.ffutop.com/blog/_next/static/chunks/commons.ca07934498d0c5523bf5.js" as="script"/><link rel="preload" href="https://www.ffutop.com/blog/_next/static/chunks/styles.74c43a0e96cfe845a889.js" as="script"/><link rel="preload" href="https://www.ffutop.com/blog/_next/static/runtime/main-3daabeb1dde7624c7fe0.js" as="script"/><link rel="stylesheet" href="https://www.ffutop.com/blog/_next/static/css/commons.a1d4ae30.chunk.css"/><link rel="stylesheet" href="https://www.ffutop.com/blog/_next/static/css/styles.d723af22.chunk.css"/></head><body><div id="__next"><header class="component-header"><h1 class="title">ffutop</h1><ul class="nav-items"><li><a href="/blog/index">åšå®¢</a></li><li><a href="/blog/archives">å½’æ¡£</a></li><li><a href="/blog/tags">æ ‡ç­¾</a></li><li><a href="/blog/about">å…³äº</a></li></ul></header><div><main class="main"><div><div class="component-post-digest"><h1 class="title"><a href="/blog2018-03-01-åŒºå—é“¾ç®€å•ä»‹ç»">åŒºå—é“¾æŠ€æœ¯æ¦‚è¿°</a></h1><div><p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fs8oc4ri7qj30mq055aap.jpg" alt="åŒºå—é“¾ç®€å•ç»“æ„"></p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1foxcpmmpfhj31kw107n2e.jpg" alt="Merkle tree"></p></div><p><a href="/blog2018-03-01-åŒºå—é“¾ç®€å•ä»‹ç»">é˜…è¯»æ›´å¤š</a></p><hr/></div></div><div><div class="component-post-digest"><h1 class="title"><a href="/blog2018-01-15-Spring-JDBC-Code-Reading">Spring JDBC æºç å­¦ä¹ </a></h1><div><h2>æ¦‚è§ˆ</h2>
<p>åœ¨å­¦ä¹  Spring-JDBC ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦ä» Java åŸç”Ÿæä¾›çš„ JDBC å¼€å§‹ï¼Œå¯¹ JDBC æ“ä½œçš„ä¸€æ•´å¥—å®Œæ•´çš„æµç¨‹æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¦‚å¿µã€‚</p></div><p><a href="/blog2018-01-15-Spring-JDBC-Code-Reading">é˜…è¯»æ›´å¤š</a></p><hr/></div></div><div><a href="/blog/page/3">ä¸Šä¸€é¡µ</a></div></main><footer class="footer">ffutop Â© <!-- -->2019<!-- -->, Built with<a href="https://reactjs.org/">React</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{}},"page":"/","query":{"mdDatasParts":[{"url":"2018-03-01-åŒºå—é“¾ç®€å•ä»‹ç»","fileName":"2018-03-01-åŒºå—é“¾ç®€å•ä»‹ç».md","title":"åŒºå—é“¾æŠ€æœ¯æ¦‚è¿°","author":"fangfeng","date":"2018-03-01T00:00:00.000Z","tags":["BlockChain","Smart Contract"],"content":"\u003cp\u003e\u003cimg src=\"https://ws3.sinaimg.cn/large/006tKfTcgy1fs8oc4ri7qj30mq055aap.jpg\" alt=\"åŒºå—é“¾ç®€å•ç»“æ„\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://ws1.sinaimg.cn/large/006tNc79gy1foxcpmmpfhj31kw107n2e.jpg\" alt=\"Merkle tree\"\u003e\u003c/p\u003e\n\u003ch2\u003eåŸºæœ¬å·¥ä½œæµç¨‹\u003c/h2\u003e\n\u003ch3\u003eæ–°äº¤æ˜“å‘èµ·æµç¨‹\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eç”¨æˆ·é€šè¿‡å…¬/ç§é’¥ä¸åŒºå—é“¾ç½‘ç»œè¿›è¡Œäº¤äº’\u003c/li\u003e\n\u003cli\u003eå¤„ç†ç”¨æˆ·äº¤æ˜“çš„èŠ‚ç‚¹å‘ç½‘ç»œé‚»èŠ‚ç‚¹å¹¿æ’­ç”¨æˆ·äº¤æ˜“\u003c/li\u003e\n\u003cli\u003eé‚»èŠ‚ç‚¹éªŒè¯äº¤æ˜“çš„æœ‰æ•ˆæ€§ï¼›å¯ä¿¡ï¼Œç»§ç»­å‘å…¶å®ƒé‚»èŠ‚ç‚¹å¹¿æ’­ï¼›ä¸å¯ä¿¡ï¼Œä¸¢å¼ƒã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eæ–°åŒºå—äº§ç”Ÿæµç¨‹\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eçŸ¿å·¥å°è¯•å°†ä¸€ä¸ªæ—¶é—´åŒºé—´å†…çš„äº¤æ˜“è¿›è¡Œæ‰“åŒ…å½¢æˆæ–°åŒºå—ï¼ˆæ€ä¹ˆæ‰“åŒ…ï¼Œçœ‹ä¸‹æ–‡ï¼‰\u003c/li\u003e\n\u003cli\u003eç”Ÿäº§å‡ºæ–°åŒºå—çš„çŸ¿å·¥èŠ‚ç‚¹å‘ç½‘ç»œå¹¿æ’­æ–°åŒºå—\u003c/li\u003e\n\u003cli\u003eæ”¶åˆ°æ–°åŒºå—çš„ç½‘ç»œèŠ‚ç‚¹éªŒè¯è¯¥åŒºå—çš„æœ‰æ•ˆæ€§\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003ca href=\"https://blockchain.info/zh-cn\"\u003eæ¯”ç‰¹å¸åŒºå—æµè§ˆå™¨\u003c/a\u003e      æ›´å¤š\u003ca href=\"https://en.wikipedia.org/wiki/Metric_prefix\"\u003eå›½é™…å•ä½åˆ¶å‰ç¼€\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003eç½‘ç»œå…±è¯†\u003c/h2\u003e\n\u003cp\u003eæ‰€æœ‰åŒºå—é“¾ç½‘ç»œèŠ‚ç‚¹éœ€è¦å¯¹äº¤æ˜“ä»¥åŠå…¶åœ¨æ–°åŒºå—é‡Œé¢çš„é¡ºåºè¾¾æˆä¸€è‡´ï¼ˆäº¤æ˜“çš„æœ‰æ•ˆæ€§ä»¥åŠäº¤æ˜“çš„æ‰“åŒ…é¡ºåºï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003eå¯èƒ½å‡ºç°ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¥³å·«æ”»å‡»â€”â€”å•ä¸€å®ä½“ä»¥å¤šé‡èº«ä»½é‡å¤å¯¹æ–°åŒºå—ç»“æœè¿›è¡Œè¡¨å†³ï¼ˆå°‘æ•°äººæŠ“ä½äº†ç½‘ç»œçš„æŠ•ç¥¨æƒï¼‰\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://zh.wikipedia.org/wiki/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B%E9%97%AE%E9%A2%98\"\u003eæ‹œå åº­å°†å†›é—®é¢˜\u003c/a\u003eâ€”â€”åˆ†å¸ƒå¼å¯¹ç­‰ç½‘ç»œçš„é€šä¿¡å®¹é”™é—®é¢˜\u003cul\u003e\n\u003cli\u003eä¸åŒçš„è®¡ç®—æœºé€šè¿‡é€šè®¯äº¤æ¢ä¿¡æ¯è¾¾æˆå…±è¯†è€ŒæŒ‰ç…§åŒä¸€å¥—åä½œç­–ç•¥è¡ŒåŠ¨\u003cul\u003e\n\u003cli\u003eæˆå‘˜è®¡ç®—æœºå¯èƒ½å‡ºé”™è€Œå‘é€é”™è¯¯ä¿¡æ¯\u003c/li\u003e\n\u003cli\u003eç½‘ç»œçš„ä¸å¯é æ€§\u003c/li\u003e\n\u003cli\u003eä»è€Œå½±å“ç½‘ç»œå…±è¯†çš„è¾¾æˆï¼Œç ´åä¸€è‡´æ€§ã€‚\u003c/li\u003e\n\u003c/ul\u003e\u003c/li\u003e\n\u003cli\u003eä¸è§£å†³çš„è¯å¯èƒ½å¯¼è‡´â€”â€”åŒºå—é“¾åˆ†å‰\u003c/li\u003e\n\u003c/ul\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè§£å†³æ–¹æ¡ˆï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå·¥ä½œé‡è¯æ˜ï¼ˆproof-of-work, PoWï¼‰ï¼Œæƒç›Šè¯æ˜(proof-of-stake, PoS)ï¼Œç™½åå•æœºåˆ¶ï¼ˆä»…é€‚ç”¨äºç§æœ‰ç½‘ç»œï¼‰ç­‰\u003c/li\u003e\n\u003cli\u003eå®ç”¨æ‹œå åº­å®¹é”™ç®—æ³•\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eå±€é™\u003c/h3\u003e\n\u003cp\u003eç½‘ç»œå…±è¯†æœºåˆ¶çš„å®ç°å¯¼è‡´äº†ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eäº¤æ˜“ååé‡\u003c/li\u003e\n\u003cli\u003eæ›´é«˜çš„äº¤æ˜“æ—¶å»¶ã€‚äº¤æ˜“ç¡®è®¤æ—¶é—´ï¼ˆåªæœ‰æ‰“åŒ…çš„æ–°åŒºå—ä¸­æ‰äº¤æ˜“æ‰ä¼šè¢«æ‰¿è®¤ï¼‰ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eå…±è¯†æœºåˆ¶çš„ä¼¸ç¼©å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³ä¸Šè¿°é—®é¢˜\u003c/p\u003e\n\u003ch2\u003eèµ„äº§äº¤æ˜“\u003c/h2\u003e\n\u003cp\u003eç®€å•äº¤æ˜“çŠ¶æ€æè¿°ï¼Œä»¥é›†ä¸­å¼æ•°æ®åº“ä¸ºä¾‹\u003c/p\u003e\n\u003cp\u003eå‡è®¾åˆå§‹çŠ¶æ€ä¸º\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e-------------------------\n| èµ„äº§ç±»å‹ | æ‰€æœ‰è€… | æ•°é‡ |\n-------------------------\n|   CNY   |  é˜²é£  |  10 |\n-------------------------\n|   CNY   |  çº¢è–¯  |  0  |\n-------------------------\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eé˜²é£ å‘ çº¢è–¯ è½¬è´¦ 2 CNY \u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e-------------------------\n| èµ„äº§ç±»å‹ | æ‰€æœ‰è€… | æ•°é‡ |\n-------------------------\n|   CNY   |  é˜²é£  |  8  |\n-------------------------\n|   CNY   |  çº¢è–¯  |  2  |\n-------------------------\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæ•°æ®åº“ä¸­ç›¸åº”è®°å½•çš„æ›´æ”¹å®Œæˆäº†èµ„äº§çš„äº¤æ˜“è¿‡ç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨åŒºå—é“¾ä¸­ï¼Œä»ç„¶å°†åˆ†å¸ƒå¼é“¾çœ‹ä½œæ˜¯ä¸€ä¸ªè¾¾æˆå…±è¯†çš„é›†ä¸­å¼æ•°æ®åº“\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆç°åœ¨çš„åˆå§‹çŠ¶æ€å¯ä»¥è¡¨ç¤ºæˆ\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e---------------------------------\n| èµ„äº§ç±»å‹ |     æ‰€æœ‰è€…     | æ•°é‡ |\n---------------------------------\n|   IOTA  |  é˜²é£ pub_key  | 10  |\n---------------------------------\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eç°åœ¨çš„æ‰€æœ‰è€…ç”±å…¬é’¥è¡¨ç¤ºï¼Œæƒ³è¦ä¿®æ”¹è®°å½•å¿…é¡»æä¾›å¯¹åº”çš„å¯†é’¥ã€‚\u003c/p\u003e\n\u003cp\u003eä¾‹å¦‚ï¼Œé˜²é£ å‘ çº¢è–¯ è½¬è´¦ 2 IOTA ï¼Œéœ€è¦æä¾›é˜²é£çš„ç§é’¥å’Œçº¢è–¯çš„å…¬é’¥ã€‚äº¤æ˜“è®°å½•ä¿®æ”¹ç»“æœï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e---------------------------------\n| èµ„äº§ç±»å‹ |     æ‰€æœ‰è€…     | æ•°é‡ |\n---------------------------------\n                                 è¢«åˆ é™¤äº†         |   IOTA  |  é˜²é£ pub_key  | 10  |\n---------------------------------\n|   IOTA  |  çº¢è–¯ pub_key  |  2  |\n---------------------------------\n|   IOTA  |  é˜²é£ pub_key  |  8  |\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eäº¤æ˜“çš„æ¦‚å¿µæµç¨‹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eå®šä½é˜²é£æ‰€æœ‰çš„èµ„äº§è®°å½•è¡Œ\u003c/li\u003e\n\u003cli\u003eåˆ é™¤è¯¥è¡Œå‰éªŒè¯å¯†é’¥\u003c/li\u003e\n\u003cli\u003eç¡®è®¤è¯¥è®°å½•æ²¡æœ‰è¢«åˆ«çš„äº¤æ˜“ä½¿ç”¨ï¼ˆåŒèŠ±é—®é¢˜ï¼ŒåŒé‡äº¤æ˜“ï¼‰\u003c/li\u003e\n\u003cli\u003eå†™å…¥æ–°çš„æ­£ç¡®çš„è®°å½•ï¼ˆçº¢è–¯è·å¾—çš„èµ„äº§ \u0026#x26; é˜²é£å‰©ä½™çš„èµ„äº§ï¼‰ï¼Œç¡®ä¿äº¤æ˜“å‰ä¸äº¤æ˜“åèµ„äº§æ€»é¢ä¸å˜\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eä¸Šé¢çš„æ¨¡å‹ â€”â€” åŸºäºæ¯”ç‰¹å¸çš„äº¤æ˜“æ¨¡å‹(UTXO \u003cem\u003emodel\u003c/em\u003e)\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eé€‚åˆäºæ•°å­—æ ‡è®°èµ„äº§çš„ä¼ è¾“ä¸è¿½è¸ª\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ¦‚å¿µï¼šUTXO (unspent transaction outputs) æœªèŠ±è´¹çš„äº¤æ˜“è¾“å‡ºï¼šæ•°æ®åº“ç°æœ‰çš„è®°å½•\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e---------------------------------\u003c/p\u003e\n\u003cp\u003eå¦ä¸€ç§æ¨¡å‹å¸¸ç”¨äºæ™ºèƒ½åˆçº¦ â€”â€” åŸºäºè´¦å·çš„æ¨¡å‹(account-based \u003cem\u003emodel\u003c/em\u003e)\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæä¾›äº†å»ºç«‹å¤šæ­¥éª¤æ‰§è¡Œçš„åŸºæœ¬æœºåˆ¶\u003c/strong\u003e \u003c/p\u003e\n\u003ch3\u003eèµ„äº§å¦‚ä½•äº§ç”Ÿ\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eæ¯”ç‰¹å¸ï¼š\u003cul\u003e\n\u003cli\u003eçŸ¿å·¥èŠ‚ç‚¹å…è®¸åœ¨æŒ–å‡ºçš„æ–°èŠ‚ç‚¹ä¸­åŠ å…¥ä¸€ç§ coinbase ç±»å‹çš„äº¤æ˜“ï¼ˆä¸å­˜åœ¨äº¤æ˜“è¾“å…¥ï¼Œæ–°èµ„äº§æ•°é¢æœ‰æ¯”ç‰¹å¸é“¾æå‰å®šä¹‰ï¼‰\u003c/li\u003e\n\u003c/ul\u003e\u003c/li\u003e\n\u003cli\u003eåœ¨åˆ›å§‹æ–°ä»£å¸çš„æ—¶å€™å…¨é¢å‘è¡Œ\u003c/li\u003e\n\u003cli\u003eå…¶å®ƒæœºåˆ¶\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eåŒºå—é“¾ç‰¹æ€§\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eä¸€ç§å¥å£®çš„ã€çœŸæ­£çš„åˆ†å¸ƒå¼å¯¹ç­‰ç³»ç»Ÿï¼Œå®ƒèƒ½å®¹å¿èŠ‚ç‚¹æ•…éšœã€‚\u003c/li\u003e\n\u003cli\u003eèƒ½å¤Ÿè¯†åˆ«å†²çªå’Œåˆ†å‰å¹¶è‡ªåŠ¨è§£å†³çš„ç½‘ç»œï¼Œä»¥ä¾¿æ”¶æ•›åˆ°å•ä¸€çš„ã€å…¬è®¤çš„å”¯ä¸€çŠ¶æ€ã€‚ï¼ˆåŒºå—é“¾æ°¸è¿œé€‰æ‹©æœ€é•¿çš„åˆ†æ”¯æ¥è¾¾æˆç½‘ç»œä¸Šçš„å…±è¯†ï¼‰\u003c/li\u003e\n\u003cli\u003eç½‘ç»œæ´»åŠ¨çš„é€æ˜æ€§ã€å¯éªŒè¯æ€§ã€å¯å®¡è®¡æ€§ã€‚æˆ‘ä»¬èƒ½è·å–å¯éªŒè¯çš„è¿‡ç¨‹ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦äº¤æ¢å’Œè·Ÿè¸ªæ•°å­—èµ„äº§ï¼Œè¿˜æ˜¯æ•°æ®é©±åŠ¨çš„äº¤äº’ã€‚æ¯ä¸€ä¸ªè¡Œä¸ºï¼Œéƒ½å­˜æœ‰å…¬å¼€çš„ä¸ç½‘ç»œäº¤äº’çš„è®°å½•ï¼Œå¹¶ä»¥æ­¤æ¥æ¶ˆé™¤äººä¸ºçš„çŸ›ç›¾ã€‚\u003c/li\u003e\n\u003cli\u003eè¿™æ˜¯ä¸€ç§å¯ä»¥æ ‡è®°ä¸åŒä¿¡æ¯çš„è§¦å‘è€…çš„æ–¹æ³•ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨æ²¡æœ‰ä¸­å¤®æƒå¨çš„æƒ…å†µä¸‹å¼ºåˆ¶æ‰§è¡Œã€‚\u003c/li\u003e\n\u003cli\u003eè¿™æ˜¯ä¸€ä¸ªä½¿å¾—ä¸ä¿¡ä»»åŒæ–¹æ ¹æ®å¯é¢„æµ‹çš„ã€ç¡®å®šæ€§çš„æ–¹å¼äº¤äº’çš„ç³»ç»Ÿã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eæ™ºèƒ½åˆçº¦\u003c/h2\u003e\n\u003cp\u003eè‡ªåŠ¨åŒ–åœ°æ‰§è¡Œä¸€ç³»åˆ—åˆçº¦æ¡æ¬¾çš„äº¤æ˜“åè®®\u003c/p\u003e\n\u003cp\u003eæ™ºèƒ½åˆçº¦æ˜¯å­˜å‚¨åœ¨åŒºå—é“¾ä¸­çš„è„šæœ¬ï¼ˆè®¤è¯†ä¸Šå¯ä»¥ä¸å…³ç³»å‹æ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹ç±»ä¼¼ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥åŸºäºè´¦å·çš„æ¨¡å‹ä¸ºä¾‹å¯¹åˆçº¦æ‰§è¡Œè¿›è¡Œæè¿°ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eå‡è®¾å®šä¹‰ä¸€ä¸ªåˆçº¦ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªæ–¹æ³•\n\n(1) â€œå­˜å‚¨â€â€”â€”åˆçº¦çš„â€œå­˜æ¬¾â€åŠŸèƒ½å…è®¸ é˜²é£ï¼ˆé€šè¿‡é˜²é£çš„å¯†é’¥éªŒè¯ï¼‰å°†è‹¥å¹²å•ä½çš„Xå­˜å…¥åˆçº¦ä¸­ï¼›\n(2) â€œäº¤æ˜“â€â€”â€”â€œäº¤æ˜“â€åŠŸèƒ½å…è®¸ä»»ä½•äººå‘åˆçº¦å‘é€5å•ä½Yï¼Œå¹¶ä»åˆçº¦æŒæœ‰çš„Xä¸­è¿”å›1å•ä½ç»™äº¤æ˜“æ–¹ï¼›\n(3) â€œæ’¤é”€â€â€”â€”â€œæ’¤é”€â€åŠŸèƒ½å…è®¸ é˜²é£ å–å‡ºåˆçº¦ä¸­å­˜æœ‰çš„æ‰€æœ‰èµ„äº§ã€‚\n\n    è¯·æ³¨æ„ï¼Œä¸Šè¿°â€œå­˜æ¬¾â€å’Œâ€œæ’¤é”€â€åŠŸèƒ½è¢«é™åˆ¶ä¸ºåªå…è®¸è¢« é˜²é£ï¼ˆå®é™…ä¸Šæ˜¯é˜²é£çš„ç§é’¥ï¼‰è°ƒç”¨ã€‚å½“ç„¶ï¼Œè¿™åªæœ‰ç”±äºä¸Šè¿°åˆçº¦ç”±é˜²é£åˆ¶å®šã€‚è‹¥äººä¸ºçš„åˆ¶å®šä¸€ä¸ªæ‰€æœ‰äººéƒ½èƒ½è°ƒç”¨ä»»ä½•åŠŸèƒ½çš„åˆçº¦ä¹Ÿæ˜¯å…è®¸çš„ï¼ˆè™½ç„¶è¿™åœ¨äº‹å®ä¸Šæ²¡æœ‰æ„ä¹‰ï¼‰ã€‚\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eé‚£ä¹ˆåœ¨åŸºäºè´¦æˆ·çš„æ¨¡å‹ä¸‹ï¼Œå¯ä»¥è®¤ä¸º æ‹¥æœ‰â€œå­˜å‚¨â€ã€â€œäº¤æ˜“â€ã€â€œæ’¤é”€â€æ–¹æ³•çš„åˆçº¦æŒæœ‰ä¸€ä¸ªå•ç‹¬çš„è´¦æˆ·ï¼ˆä¸ç”¨æˆ·æ‰€æŒæœ‰çš„è´¦æˆ·ç­‰ä»·ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ä¸Šè¿°åˆçº¦ä¸‹ï¼Œè¿™ä¸ªè´¦æˆ·å°†å¯èƒ½æŒæœ‰ä¸€å®šæ•°é‡çš„èµ„äº§ã€‚é™¤äº†åªèƒ½æŒ‰ç…§é¢„å®šçš„åˆçº¦æ­¥éª¤å¯¹èµ„äº§è¿›è¡Œå¤„ç½®ä¹‹å¤–ï¼Œå…¶å®ƒä¸ç”¨æˆ·æŒæœ‰çš„è´¦æˆ·åˆ«æ— äºŒè‡´ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-text\"\u003e  __                    __\n / _| __ _ _ __   __ _ / _| ___ _ __   __ _\n| |_ / _` | '_ \\ / _` | |_ / _ \\ '_ \\ / _` |\n|  _| (_| | | | | (_| |  _|  __/ | | | (_| |\n|_|  \\__,_|_| |_|\\__, |_|  \\___|_| |_|\\__, |\n                 |___/                |___/\n\u003c/code\u003e\u003c/pre\u003e","digest":"\u003cp\u003e\u003cimg src=\"https://ws3.sinaimg.cn/large/006tKfTcgy1fs8oc4ri7qj30mq055aap.jpg\" alt=\"åŒºå—é“¾ç®€å•ç»“æ„\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://ws1.sinaimg.cn/large/006tNc79gy1foxcpmmpfhj31kw107n2e.jpg\" alt=\"Merkle tree\"\u003e\u003c/p\u003e"},{"url":"2018-01-15-Spring-JDBC-Code-Reading","fileName":"2018-01-15-Spring-JDBC-Code-Reading.md","title":"Spring JDBC æºç å­¦ä¹ ","author":"fangfeng","date":"2018-01-15T00:00:00.000Z","tags":["Spring","JDBC"],"content":"\u003ch2\u003eæ¦‚è§ˆ\u003c/h2\u003e\n\u003cp\u003eåœ¨å­¦ä¹  Spring-JDBC ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦ä» Java åŸç”Ÿæä¾›çš„ JDBC å¼€å§‹ï¼Œå¯¹ JDBC æ“ä½œçš„ä¸€æ•´å¥—å®Œæ•´çš„æµç¨‹æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¦‚å¿µã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e/**\n * copied from https://www.tutorialspoint.com/jdbc/jdbc-sample-code.htm\n * updated by DorMOUSENone\n */\n\n//STEP 1. å¼•å…¥å¿…é¡»çš„åŒ…\nimport java.sql.*;\n\npublic class Example {\n    // JDBC é©±åŠ¨å ä¸ DB URL \n    static final String JDBC_DRIVER = \"com.mysql.jdbc.Driver\";  \n    static final String DB_URL = \"jdbc:mysql://\u0026#x3C;host\u003e:\u0026#x3C;port\u003e/\u0026#x3C;dbName\u003e\";\n\n    // æ•°æ®åº“ç™»å½•éªŒè¯ (ç”¨æˆ·åã€å¯†ç ç­‰)\n    static final String USER = \"username\";\n    static final String PASS = \"password\";\n   \n    public static void main(String[] args) {\n        Connection conn = null;\n        Statement stmt = null;\n        try{\n            //STEP 2: æ³¨å†Œé©±åŠ¨(æ³¨å†Œåˆ°é©±åŠ¨ç®¡ç†å™¨ DriverManager ç±»ä¸­)\n            Class.forName(\"com.mysql.jdbc.Driver\");\n\n            //STEP 3: åˆ›å»ºä¸€ä¸ªè¿æ¥\n            System.out.println(\"Connecting to database...\");\n            conn = DriverManager.getConnection(DB_URL,USER,PASS);\n\n            //STEP 4: æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢\n            System.out.println(\"Creating statement...\");\n            stmt = conn.createStatement();\n            String sql;\n            sql = \"SELECT id, first, last, age FROM Employees\";\n            ResultSet rs = stmt.executeQuery(sql);\n\n            //STEP 5: å°†ç»“æœä»ç»“æœé›†(ResultSet)ä¸­å–å‡º\n            while(rs.next()){\n                //æ ¹æ®åˆ—åé€ä¸€å–å‡ºæ•°æ®\n                int id  = rs.getInt(\"id\");\n                int age = rs.getInt(\"age\");\n                String first = rs.getString(\"first\");\n                String last = rs.getString(\"last\");\n\n                //å±•ç¤ºç»“æœ\n                System.out.print(\"ID: \" + id);\n                System.out.print(\", Age: \" + age);\n                System.out.print(\", First: \" + first);\n                System.out.println(\", Last: \" + last);\n            }\n            //STEP 6: æ¸…ç†ç¯å¢ƒ\n            rs.close();\n            stmt.close();\n            conn.close();\n        }catch(SQLException se){\n            //å¤„ç† JDBC é”™è¯¯\n            se.printStackTrace();\n        }catch(Exception e){\n            //å¤„ç† Class.forName() å¼•èµ·çš„é”™è¯¯\n            e.printStackTrace();\n        }finally{\n            // finally ä»£ç åº“æ¥å…³é—­èµ„æº\n            try{\n                if(stmt!=null)\n                    stmt.close();\n            }catch(SQLException se2){\n            }// ä¸åšä»»ä½•å¤„ç†\n            try{\n                if(conn!=null)\n                    conn.close();\n            }catch(SQLException se){\n                se.printStackTrace();\n            }\n        }\n        System.out.println(\"Goodbye!\");\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä»ä¸Šé¢çš„é€šç”¨ JDBC ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œåˆ©ç”¨ Java åŸç”Ÿæä¾›çš„ java.sql.* åŒ…å¯ä»¥å®Œæˆæ³¨å†Œé©±åŠ¨ï¼Œåˆ›å»ºè¿æ¥ï¼Œæ‰§è¡ŒæŸ¥è¯¢ï¼Œå¤„ç†ç»“æœç­‰ä¸€ç³»åˆ—ä¸€æ•´å¥—æ“ä½œã€‚\u003c/p\u003e\n\u003cp\u003eè€Œ Spring-JDBC å¯¹äº Java åŸç”Ÿæä¾›çš„ JDBC ï¼Œå¯¹ä¸€ç³»åˆ—æ•°æ®åŠæ“ä½œè¿›è¡Œäº†æ•´åˆï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eå®ç°äº† DataSource æ¥å£ï¼Œç”¨äºæ•´åˆæ•°æ®æºé…ç½®ï¼Œå°†å„ç§é›¶æ•£çš„å±æ€§å€¼ï¼ˆè¯¸å¦‚ URLã€ç”¨æˆ·åã€ å¯†ç ç­‰ï¼‰æ•´åˆæˆå®Œæ•´çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä¾¿äºé‡ç”¨ï¼›ä¹Ÿå®ç°äº† getConnection(â€¦) æ¥å£ï¼Œä¾¿äºç›´æ¥é€šè¿‡ DataSource è·å–è¿æ¥ã€‚\u003c/li\u003e\n\u003cli\u003eå¯¹æ‰§è¡ŒæŸ¥è¯¢çš„æµç¨‹è¿›è¡Œäº†å°è£…ã€‚\u003c/li\u003e\n\u003cli\u003eå¯¹ç»“æœé›†çš„å¤„ç†æä¾›äº†å¤šç§æ¥å£ï¼Œé’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯å¯è‡ªç”±é€‰æ‹©æ‰€å¿…é¡»çš„å®ç°ç±»ã€‚ä¾‹å¦‚ç›´æ¥é€šè¿‡ JDBC è·å¾— Bean ï¼Œè€Œæ— éœ€å¦‚ä¸Šä¾‹ 39-42 è¡Œæ‰€ç¤ºï¼Œé€ä¸€ç¼–ç è¿›è¡Œæå–ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eæœ¬èŠ‚æä¾›å¯¹ã€ŠSpring-JDBC æºç å­¦ä¹ ã€‹å®Œæ•´å­¦ä¹ è¿‡ç¨‹çš„ä¸€ä¸ªæ¢³ç†ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"http://blog.csdn.net/dormousenone/article/details/79035440\"\u003eJdbcTemplate\u003c/a\u003e ä¸€èŠ‚ä½œä¸ºå­¦ä¹  Spring-jdbc çš„åˆ‡å…¥ç‚¹ï¼Œæ˜¯ org.springframework.jdbc.core åŒ…ä¸­çš„æ ¸å¿ƒç±»ï¼Œæ˜¯ä¸€ä¸ªæä¾›ä¸åŒåœºæ™¯ä¸‹æ•°æ®åº“æ“ä½œçš„æ¨¡æ¿ç±»ã€‚ä¸»è¦æè¿°å…¶æŒæœ‰çš„å±æ€§ DataSource ç­‰ä»¥åŠå…¶å®ç°çš„æ–¹æ³•ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://blog.csdn.net/dormousenone/article/details/79037012\"\u003eDataSource\u003c/a\u003e ä¸€èŠ‚æ‰¿æ¥ JdbcTemplate ä¸€èŠ‚ï¼Œæä¾› Spring-jdbc å¯¹æ•°æ®æºçš„ä¸€ä¸ªåŒ…è£…ä¸åº”ç”¨ã€‚åŒæ—¶æè¿°å…¶æ ¸å¿ƒæ–¹æ³• getConnection(â€¦) çš„å®ç°ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://blog.csdn.net/dormousenone/article/details/79042212\"\u003eDriverManager\u003c/a\u003e æè¿°å…¶å¯¹ä¸åŒæ•°æ®åº“ä¾›åº”å•†æä¾›çš„é©±åŠ¨çš„ç®¡ç†ä¸ä½¿ç”¨æ–¹æ³•ã€‚åŒæ—¶ç®€å•æè¿°é€šè¿‡å…·ä½“é©±åŠ¨è·å¾—ä¸€ä¸ªè¿æ¥çš„å®ç°ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://blog.csdn.net/dormousenone/article/details/79046865\"\u003ePreparedStatement \u0026#x26; CallableStatement\u003c/a\u003e ä¸€èŠ‚ä¸»è¦è¡¨è¿° Spring-jdbc å¦‚ä½•å¯¹æ‰§è¡ŒæŸ¥è¯¢çš„æµç¨‹è¿›è¡Œäº†å°è£…ã€‚ç‰¹åˆ«æ˜¯å¯¹äº PreparedStatement ä¸ CallableStatement è¿™ç±»é¢„ç½®å¯å˜ SQL è¯­å¥ï¼Œåœ¨æ‰§è¡Œå‰å¿…é¡»å¯¹å…¶ä¸­å¯å˜å‚æ•°è¿›è¡Œè¡¥å…¨çš„ Statement ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://blog.csdn.net/dormousenone/article/details/79062275\"\u003eResultSet\u003c/a\u003e æè¿° Spring-jdbc å¦‚ä½•å¯¹ç»“æœé›†è¿›è¡Œå¤„ç†ï¼Œæä¾›äº†å¤šç§ä¸åŒçš„æ¥å£å®ç°ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚è¿™ç§å°è£…åçš„æ“ä½œå¯ä»¥æå¤§åœ°ç®€åŒ–ç›´æ¥ä½¿ç”¨ Java åŸç”Ÿ JDBC æ‰€å¿…é¡»çš„ç¡¬ç¼–ç æå–æ•°æ®çš„é—®é¢˜ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eJdbcTemplate\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://ws2.sinaimg.cn/large/006tNc79gy1fn90ghu9ufj30ki0jm75t.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003eJdbcTemplate ç±»ä½œä¸º org.springframework.core åŒ…ä¸‹çš„æ ¸å¿ƒç±»ï¼Œå¯¹ Java å®ç°çš„ JDBC è¿›è¡Œäº†ä¸€å®šç¨‹åº¦çš„å°è£…ï¼Œå¯ä»¥ç®€åŒ– JDBC çš„ä½¿ç”¨ï¼ŒåŒæ—¶é¿å…è®¸å¤šå¸¸è§çš„é”™è¯¯ã€‚ç”±è¯¥ç±»æ¥æ‰§è¡Œ JDBC å·¥ä½œæµï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦æä¾› SQL è¯­å¥å°±å¯ä»¥è·å¾— DB æ‰§è¡Œç»“æœï¼ˆğŸ˜€ï¼Œå½“ç„¶å®é™…æ“ä½œä¸Šæ²¡æœ‰æè¿°çš„è¿™ä¹ˆç®€å•ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eä½¿ç”¨ JdbcTemplate ç±»åªéœ€è¦å®ç°ä¸¤ä¸ªå›è°ƒæ¥å£ PreparedStatementCreator (åˆ›å»ºä¸€ä¸ª PreparedStatementï¼Œç»™å®šè¿æ¥ï¼Œæä¾› SQL è¯­å¥ä»¥åŠå¿…è¦çš„å‚æ•°), ResultSetExtractor (ç”¨äºèŠ±å¼è·å–ç»“æœé›†)ã€‚å½“ç„¶ï¼Œä¸å®ç°ä¸Šè¿°ä¸¤ä¸ªæ¥å£ä¹Ÿå¯ä»¥è¿›è¡Œç®€å•çš„æ•°æ®åº“æ“ä½œï¼Œæ¯”å¦‚åªé€šè¿‡ JdbcTemplate è·å–ä¸€ä¸ªè¿æ¥(Connection) æˆ–è€…æ‰§è¡Œä¸€ä¸ªé™æ€ SQL Updateã€‚\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eçœ‹ä¸æ‡‚æ— æ‰€è°“ï¼Œå…ˆç»§ç»­å‘ä¸‹çœ‹ï¼Œä¼šåšæ›´è¯¦ç»†çš„è®²è§£ã€‚\u003c/em\u003e\u003c/p\u003e\n\u003ch3\u003eJdbcAccessor\u003c/h3\u003e\n\u003cp\u003eé¦–å…ˆäº†è§£ JdbcTemplate çš„å®ç°ï¼ŒJdbcTemplate ç»§æ‰¿äº† JdbcAccessor æŠ½è±¡ç±»ï¼Œè¯¥æŠ½è±¡ç±»æœ‰ä¸¤ä¸ªä¸»è¦å±æ€§â€”â€” \u003cstrong\u003eDataSource dataSource\u003c/strong\u003e \u0026#x26; \u003cstrong\u003eSQLExceptionTranslator exceptionTranslator\u003c/strong\u003e ï¼Œä»¥åŠä¸€ä¸ªæ‡’åŠ è½½æ ‡è¯†ç¬¦ \u003cstrong\u003elazyInit\u003c/strong\u003e ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­ï¼Œ\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDataSource å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå­˜å‚¨æœ‰ä¸æ•°æ®åº“ç›¸å…³çš„å±æ€§å®ä¾‹ï¼Œä¸»è¦æ–¹æ³•åŒ…æ‹¬ \u003ccode\u003eConnection getConnection()\u003c/code\u003e \u0026#x26; \u003ccode\u003eConnection getConnection(String username, String password)\u003c/code\u003e ã€‚\u003c/li\u003e\n\u003cli\u003eSQLExceptionTranslator åˆ©ç”¨ç­–ç•¥æ¨¡å¼å°† Java å®šä¹‰çš„ SQLException è½¬æ¢æˆ Spring å£°æ˜çš„ DataAccessExceptionã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eJdbcAccessor å®ç°çš„ InitializingBean æ¥å£ï¼ŒInitializingBean æ¥å£ä¸º Bean æä¾›äº†ä¸€ä¸ªåˆå§‹åŒ–å®ä¾‹çš„æ–¹æ³• â€”â€” afterPropertiesSet() æ–¹æ³•ï¼Œå‡¡æ˜¯ç»§æ‰¿è¯¥æ¥å£çš„ç±»ï¼Œä¸€èˆ¬éƒ½åœ¨ç±»æ„é€ æ–¹æ³•ä¸­æ‰§è¡Œè¯¥æ–¹æ³•ã€‚åŒæ ·çš„ï¼Œå£°æ˜åˆå§‹åŒ–å®ä¾‹è°ƒç”¨çš„æ–¹æ³•è¿˜å¯é‡‡ç”¨ \u003ccode\u003e\u0026#x3C;bean id=\"\" class=\"\" init-method=\"myInitMethod\"/\u003e\u003c/code\u003e åœ¨åˆå§‹åŒ– bean æ—¶æ‰§è¡Œ myInitMethod() æ–¹æ³•ã€‚å…·ä½“æ‰§è¡Œé¡ºåºä¸º ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003ebean çš„å±æ€§æ³¨å…¥\u003c/li\u003e\n\u003cli\u003eè°ƒç”¨ afterPropertiesSet() æ–¹æ³•\u003c/li\u003e\n\u003cli\u003eæ‰§è¡Œ myInitMethod() æ–¹æ³•\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eæ­¤å¤„ç»§æ‰¿è¯¥æ¥å£æ˜¯ä¸ºäº†å®ç° DataSource éªŒè¯ä»¥åŠ SQLExceptionTranslator çš„æ‡’åŠ è½½ OR NOT çš„é€‰æ‹©ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e@Override\npublic void afterPropertiesSet() {\n    if (getDataSource() == null) {  // åˆ¤æ–­æ˜¯å¦æ³¨å…¥äº† DataSource\n        throw new IllegalArgumentException(\"Property 'dataSource' is required\");\n    }\n    if (!isLazyInit()) {    // æ ¹æ®æ‡’åŠ è½½æ ‡è¯†ç¬¦é€‰æ‹©æ‰§è¡Œä¸å¦\n        getExceptionTranslator();   // è·å–ä¸€ä¸ª SQLExceptionTranslator å®ä¾‹\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eè¯¥æ–¹æ³•åœ¨ BeanFactory å®Œæˆè¯¥ bean çš„ä¾èµ–æ³¨å…¥åæ‰§è¡Œï¼Œå°†é¦–å…ˆåˆ¤æ–­ DataSource æ˜¯å¦å·²ç»è¢«æ³¨å…¥ï¼Œå†æ ¹æ®æ‡’åŠ è½½æ ‡è¯†ç¬¦æ¥å†³å®šæ˜¯å¦å®ä¾‹åŒ–ä¸€ä¸ª SQLExceptionTranslator ã€‚\u003c/p\u003e\n\u003ch3\u003eJdbcOperations\u003c/h3\u003e\n\u003cp\u003eåŒæ—¶ï¼ŒJdbcTemplate ç±»å®ç°äº† JdbcOperations æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†åŸºæœ¬çš„ JDBC æ“ä½œã€‚åŸºæœ¬æ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003e\u0026#x3C;T\u003e T execute(ConnectionCallback\u0026#x3C;T\u003e action);\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\u0026#x3C;T\u003e T execute(StatementCallback\u0026#x3C;T\u003e action);\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\u0026#x3C;T\u003e T execute(PreparedStatementCreator psc, PreparedStatementCallback\u0026#x3C;T\u003e action);\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\u0026#x3C;T\u003e T execute(CallableStatementCreator csc, CallableStatementCallback\u0026#x3C;T\u003e action);\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://ws3.sinaimg.cn/large/006tNc79gy1fncp2ncqd6j31j00au0uv.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003eå…¶å®ƒçš„ execute(â€¦) , query(â€¦), update(â€¦) ç­‰æœ€ç»ˆéƒ½å°†è°ƒç”¨ä¸Šè¿° 4 ç§æ–¹æ³•å…¶ä¸€æ¥å®Œæˆç›®çš„ã€‚\u003c/p\u003e\n\u003cp\u003eè¯¦ç»†è§‚å¯Ÿä¸Šè¿°æ–¹æ³•çš„å…¥å‚ï¼Œ ConnectionCallback, StatementCallback, PreparedStatementCallback å’Œ CallableStatementCallback å››ä¸ª Callback æ¥å£ï¼Œåˆ†åˆ«éƒ½æ˜¯å‡½æ•°å¼æ¥å£ï¼Œå…¶ä¸­çš„å”¯ä¸€æ–¹æ³• doInXXX() å°†åœ¨ execute() ä¸­è¢«è°ƒç”¨ï¼Œä»¥æ­¤å®ç°è·å¾— ResultSet å¹¶è¿”å› Result ã€‚execute ä¸­è°ƒç”¨ doInXXX() çš„é€šç”¨ä»£ç å¦‚ä¸‹ ï¼ˆä»¥ Statement ä¸ºä¾‹ï¼‰ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eå¯¹äºä¸ç†è§£\u003cstrong\u003eå›è°ƒ\u003c/strong\u003eçš„åŒå­¦ï¼Œè¯·è‡ªè¡Œäº†è§£æ¦‚å¿µ\u003c/em\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epublic \u0026#x3C;T\u003e T execute(StatementCallback\u0026#x3C;T\u003e action) throws DataAccessException {\n    // é€šè¿‡å·¥å…·ç±» DataSourceUtils è·å–ä¸€ä¸ªè¿æ¥\n    Connection con = DataSourceUtils.getConnection(obtainDataSource());\n    // ä¸€ä¸ª Statement ç©ºå®ä¾‹ï¼ŒPreparedStatement, CallableStatement ç±»ä¼¼\n    Statement stmt = null;\n    try {\n        stmt = con.createStatement();   // é€šè¿‡è¿æ¥(Connection)è·å–ä¸€ä¸ª Statement\n        applyStatementSettings(stmt);   // é…ç½® Statement å‚æ•°\n        // å›è°ƒæ‰§è¡Œ doInXXX() æ–¹æ³•, å¹¶è·å¾— result\n        T result = action.doInStatement(stmt);  \n        handleWarnings(stmt);\n        return result;\n    }\n    catch (SQLException ex) {\n        // Release Connection early, to avoid potential connection pool deadlock\n        // in the case when the exception translator hasn't been initialized yet.\n        String sql = getSql(action);\n        JdbcUtils.closeStatement(stmt);\n        stmt = null;\n        DataSourceUtils.releaseConnection(con, getDataSource());\n        con = null;\n        throw translateException(\"StatementCallback\", sql, ex);\n    }\n    finally {\n        JdbcUtils.closeStatement(stmt);\n        DataSourceUtils.releaseConnection(con, getDataSource());\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå¯¹äº Statement, PreparedStatement, CallableStatement çš„åŒºåˆ«ï¼Œé¦–å…ˆä¸‹å›¾è¡¨ç°äº†ä¸‰ä¸ªæ¥å£çš„ç»§æ‰¿å…³ç³»ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eStatement å¯ä»¥æ”¯æŒé™æ€ SQL è¯­å¥\u003c/li\u003e\n\u003cli\u003ePreparedStatement æ”¯æŒå¯å˜å‚æ•°çš„ SQL è¯­å¥\u003c/li\u003e\n\u003cli\u003eCallableStatement æ”¯æŒå¯å˜å‚æ•°çš„ SQL è¯­å¥ï¼Œå¹¶ä¸”æ”¯æŒå®šåˆ¶ DB çš„è¾“å‡ºç»“æœ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://ws3.sinaimg.cn/large/006tNc79gy1fncpaec17yj30ew0hcdh7.jpg\"\u003e\u003c/p\u003e\n\u003ch2\u003eDataSource\u003c/h2\u003e\n\u003cp\u003eä¸Šä¸€èŠ‚åœ¨ç²—ç•¥åœ°äº†è§£äº† JdbcTemplate æä¾›çš„æ–¹æ³•ä¹‹åï¼Œä¸‹é¢å…ˆæ¥å¯¹ DataSource åšä¸€ç‚¹äº†è§£ã€‚\u003c/p\u003e\n\u003ch3\u003eJava æä¾›çš„ DataSource å®šä¹‰\u003c/h3\u003e\n\u003cp\u003eDataSource æ˜¯ Java æ ¸å¿ƒåº“æä¾›çš„æ¥å£ã€‚ä½äº javax.sql package ä¸‹ã€‚\u003c/p\u003e\n\u003cp\u003eDataSource æ¥å£å¯ä»¥è¢«è§†ä½œæ˜¯ä¸€ä¸ªæä¾›ç‰©ç† DB å®ä¾‹è¿æ¥(Connection) çš„å·¥å‚ï¼Œé€šè¿‡ DataSource æŒæœ‰çš„å„ç§å±æ€§ï¼ˆåŒ…æ‹¬ DB Url, Username, Password ç­‰ï¼‰æ¥è·å–ä¸€ä¸ªè¿æ¥(Connection) ã€‚DataSource æ¥å£æœ‰ä¸‰ç§ä¸åŒçš„å®ç°æ–¹æ¡ˆï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eæœ€åŸºæœ¬çš„å®ç°â€”â€”ç”Ÿäº§ä¸€ä¸ªæ ‡å‡†è¿æ¥(Connection) å¯¹è±¡\u003c/li\u003e\n\u003cli\u003eè¿æ¥æ± æ–¹æ¡ˆâ€”â€”ç”Ÿäº§ä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°è¿æ¥æ± çš„å¯¹è±¡\u003c/li\u003e\n\u003cli\u003eåˆ†å¸ƒå¼äº‹ç‰©å®ç°â€”â€”ç”Ÿäº§ä¸€ä¸ªå¯ä»¥æ”¯æŒåˆ†å¸ƒå¼äº‹ç‰©ï¼Œå¹¶é»˜è®¤è¢«æ·»åŠ åˆ°è¿æ¥æ± çš„è¿æ¥å¯¹è±¡\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eåŒ…æ‹¬ä¸¤ä¸ªå¯¹å¤–æä¾›è¿æ¥(Connection) å¯¹è±¡çš„æ–¹æ³•ï¼Œ\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003eConnection getConnection() throws SQLException;\nConnection getConnection(String username, String password) throws SQLException;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå…¶çˆ¶æ¥å£ CommonDataSource æä¾›è®¾ç½®/è·å– LogWriterï¼Œç™»å½• DB è¶…æ—¶æ—¶é—´å’Œè·å–çˆ¶ Logger çš„æ–¹æ³•ã€‚\u003c/p\u003e\n\u003ch3\u003eSpring-JDBC æ‰©å±•çš„ DataSource å®šä¹‰\u003c/h3\u003e\n\u003cp\u003eåœ¨ Spring-jdbc ä¸‹ï¼ŒDataSources æœ€é¡¶çº§çš„ç±»æ˜¯ AbstractDataSource ï¼Œå¯¹ DataSource çš„æ‰€æœ‰çˆ¶æ¥å£æ–¹æ³•åšäº†å®ç°ã€‚ä½†ä¿ç•™ getConnection() æ–¹æ³•ç”±å­ç±»å®ç°ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ AbstractDriverBasedDataSource ä¸­ï¼Œå®šä¹‰äº†å¤§é‡çš„å‚æ•°ï¼Œè¯¸å¦‚ url, username ç­‰ï¼Œè¿™äº›éƒ½è¢«ç”¨æ¥å®šä½å¹¶å®šä¹‰ä¸æ•°æ®åº“å®ä¾‹çš„è¿æ¥ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epublic abstract class AbstractDriverBasedDataSource extends AbstractDataSource {\n\n   @Nullable\n   private String url;\n\n   @Nullable\n   private String username;\n\n   @Nullable\n   private String password;\n\n   @Nullable\n   private String catalog;\n\n   @Nullable\n   private String schema;\n\n   @Nullable\n   // å¯ä»¥çœ‹åˆ°æ­¤å¤„æœ‰ä¸€ä¸ª Properties ç±»\n   private Properties connectionProperties;\n   \n   // çœç•¥è‹¥å¹²æ–¹æ³•\n  \n\n    @Override\n    public Connection getConnection() throws SQLException {\n        // è°ƒç”¨å†…éƒ¨æ–¹æ³• getConnectionFromDriver()\n        return getConnectionFromDriver(getUsername(), getPassword());\n    }\n\n    @Override\n    public Connection getConnection(String username, String password) throws SQLException {\n        // è°ƒç”¨å†…éƒ¨æ–¹æ³• getConnectionFromDriver()\n        return getConnectionFromDriver(username, password);\n    }\n  \n   // å®šä¹‰äº†ä¸€ä¸ªè·å– Connection çš„æ–¹æ³•ï¼Œç”± getConnection() æ–¹æ³•è°ƒç”¨ï¼Œ\n   // æ­¤æ–¹æ³•ä¸»è¦æ˜¯å°†å±æ€§åšäº†ä¸€ä¸ªæ•´åˆ\n   // å…·ä½“è·å– Connection çš„é€»è¾‘ä»ç„¶ä¸‹æ”¾åˆ°å­ç±»å®ç° è§ 40 è¡Œ\n   protected Connection getConnectionFromDriver(@Nullable String username, @Nullable String password) throws SQLException {\n        Properties mergedProps = new Properties();\n        Properties connProps = getConnectionProperties();\n        if (connProps != null) {\n            mergedProps.putAll(connProps);\n        }\n        if (username != null) {\n            mergedProps.setProperty(\"user\", username);\n        }\n        if (password != null) {\n            mergedProps.setProperty(\"password\", password);\n        }\n        \n        // è·å– Connection é€»è¾‘ä¸‹æ”¾\n        Connection con = getConnectionFromDriver(mergedProps);\n        if (this.catalog != null) {\n            con.setCatalog(this.catalog);\n        }\n        if (this.schema != null) {\n            con.setSchema(this.schema);\n        }\n        return con;\n    }\n  \n    // è¯¥ç±»ä¸­è·å– Connection çš„æ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•\n    protected abstract Connection getConnectionFromDriver(Properties props) throws SQLException;\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæ•´åˆæ–¹æ¡ˆä¸ºå°†é™¤ url å¤–çš„æ‰€æœ‰å‚æ•°æ•´åˆåœ¨åŒä¸€ä¸ª Properties å¯¹è±¡ä¸­ (å…¶ä¸­ï¼ŒProperties å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Hash Map) ã€‚æœ€ç»ˆè°ƒç”¨ \u003ccode\u003eConnection getConnectionFromDriver(Properties props)\u003c/code\u003e è·å–è¿æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eAbstractDriverBasedDataSource æŠ½è±¡ç±»çš„ä¸¤ä¸ªå­ç±» DriverManagerDataSource å’Œ SimpleDriverDataSource éƒ½ä»¥ä¸åŒæ–¹å¼è·å¾—äº†è¿æ¥(Connection)ï¼Œä½†æ€»ç»“è€Œè¨€ï¼Œè·å–è¿æ¥(Connection) çš„ä»»åŠ¡è¢«å§”æ‰˜ç»™äº† Driver æ¥å®ç°ï¼ˆå…¶ä¸­ï¼ŒDriver æœ‰ Java å®šä¹‰æ¥å£ï¼Œå¹¶ç”±å„æ•°æ®åº“æä¾›å•†æä¾›ï¼Œä¾‹å¦‚ MySQL æä¾›äº† mysql-connector-java-XXX.jar æ¥å®Œæˆé’ˆå¯¹ç›¸åº”æ•°æ®åº“çš„å…·ä½“å®ç°ï¼‰ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e// ----------------------------\n// SimpleDriverDataSource çš„å®ç°\n// ----------------------------\n@Override\nprotected Connection getConnectionFromDriver(Properties props) throws SQLException {\n    Driver driver = getDriver();\n    String url = getUrl();\n    Assert.notNull(driver, \"Driver must not be null\");\n    if (logger.isDebugEnabled()) {\n        logger.debug(\"Creating new JDBC Driver Connection to [\" + url + \"]\");\n    }\n    // å“ˆå“ˆï¼Œé‡ç‚¹åœ¨è¿™... driver åœ¨è¯¥ç±»ä¸­è¢«é¢„å…ˆæ³¨å…¥\n    return driver.connect(url, props);\n}\n\n// -----------------------------\n// DriverManagerDataSource çš„å®ç°\n// -----------------------------\n@Override\nprotected Connection getConnectionFromDriver(Properties props) throws SQLException {\n    String url = getUrl();\n    Assert.state(url != null, \"'url' not set\");\n    if (logger.isDebugEnabled()) {\n        logger.debug(\"Creating new JDBC DriverManager Connection to [\" + url + \"]\");\n    }\n    // è°ƒäº†ä¸ªå†…éƒ¨å‡½æ•°\n    return getConnectionFromDriverManager(url, props);\n}\n\nprotected Connection getConnectionFromDriverManager(String url, Properties props) throws SQLException {\n    // å§”æ‰˜ç»™ DriverManager ç±»æ¥è·å–è¿æ¥\n    // DriverManager çš„ä¸»è¦æ“ä½œæ˜¯éå†åœ¨è¯¥ç®¡ç†ç±»ä¸­æ³¨å†Œçš„ Driver\n    // æ¯ä¸ª Driver å®ä¾‹éƒ½å»å°è¯•ä¸€ä¸‹ï¼Œèƒ½ä¸èƒ½è·å¾—ä¸€ä¸ªè¿æ¥\n    // ç¬¬ä¸€æ¬¡åœ¨æŸä¸ª Driver ä¸­æ‹¿åˆ°ä¸€ä¸ªè¿æ¥å³è¿”å›è¿æ¥ (Connection)\n    return DriverManager.getConnection(url, props);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eç®€è¦çš„ç±»å›¾å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://ws4.sinaimg.cn/large/006tNc79gy1fncrgqcjqoj31es15ajxj.jpg\"\u003e\u003c/p\u003e\n\u003ch2\u003eDriverManager\u003c/h2\u003e\n\u003cp\u003eä¸Šé¢æåˆ° DataSource è·å–è¿æ¥(Connection) çš„æ“ä½œå®è´¨ä¸Šå°†å§”æ‰˜å…·ä½“çš„ Driver æ¥æä¾› Connection ã€‚æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼ŒåŒ…æ‹¬ç»ç”± DriverManager éå†æ‰€æœ‰å¤„äºç®¡ç†ä¸‹çš„ Driver å°è¯•è·å–è¿æ¥ï¼Œæˆ–è€…åœ¨ DataSource å®ä¾‹ä¸­ç›´æ¥å£°æ˜ä¸€ä¸ªç‰¹å®šçš„ Driver æ¥è·å–è¿æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eå¯¹äºè·å–è¿æ¥çš„å…·ä½“æ“ä½œï¼ŒæŒ–å‘-å¾…å¡«ã€‚åªæè¿°ç®€å•çš„æ•°æ®åº“ä¾›åº”å•†æä¾›çš„ Driver å¦‚ä½•ä¸ java ç›¸è”ç³»ã€‚\u003c/p\u003e\n\u003cp\u003e###åœ¨ DriverManager ä¸­æ³¨å†Œ Driver å®ä¾‹\u003c/p\u003e\n\u003cp\u003eé€šå¸¸åœ¨ä¸æ•°æ®åº“äº¤äº’é€»è¾‘çš„ Java ä»£ç ä¸­ï¼Œéƒ½ä¼šæœ‰ \u003ccode\u003eClass.forName(\"com.mysql.jdbc.Driver\")\u003c/code\u003e (æ­¤å¤„ä»¥ MySQL æä¾›çš„ mysql-connector-java-XXX.jar ä¸ºä¾‹ï¼Œä¸‹åŒï¼‰çš„ä»£ç å—ï¼ŒåŠ è½½æŒ‡å®šçš„ com.mysql.jdbc.Driver ä¸º java.lang.Class ç±»ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eå½“ç„¶ï¼Œåœ¨ JDBC 4.0 æ ‡å‡†ä¸‹ï¼Œå¯ä»¥ä¸å¿…å†æ˜¾ç¤ºå£°æ˜ \u003ccode\u003eClass.forName(\"\")\u003c/code\u003e è¯­å¥ï¼ŒDriver ä¹ŸåŒæ ·ä¼šåœ¨ DriverManager åˆå§‹åŒ–æ—¶è‡ªåŠ¨æ³¨å†Œã€‚\u003c/em\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e// Class ç±»ä¸­å¯¹äº forName(String className) çš„æ–¹æ³•\n// ä½œç”¨ä¸ºè¿”å›ä¸€ä¸ª java.lang.Class å®ä¾‹ã€‚\npublic static Class\u0026#x3C;?\u003e forName(String className) throws ClassNotFoundException {...}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eåŒæ—¶ï¼Œ JVM åœ¨åŠ è½½ç±»çš„è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œç±»ä¸­çš„ static ä»£ç å—ã€‚ä¸‹è¿° row 10 ~ 16 çš„ä»£ç ç‰‡æ®µå°†è¢«æ‰§è¡Œã€‚å”¯ä¸€çš„é€»è¾‘å°±æ˜¯ new ä¸€ä¸ª com.mysql.jdbc.Driver å®ä¾‹ï¼Œå¹¶å°†å®ä¾‹æ³¨å†Œ(registerDriver) åˆ° \u003cstrong\u003ejava.sql.DriverManager\u003c/strong\u003e ä¸­ã€‚ \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epackage com.mysql.jdbc;\n\npublic class Driver extends NonRegisteringDriver implements java.sql.Driver {\n    // ~ Static fields/initializers\n    // ---------------------------------------------\n\n    //\n    // Register ourselves with the DriverManager\n    //\n    static {\n        try {\n            java.sql.DriverManager.registerDriver(new Driver());\n        } catch (SQLException E) {\n            throw new RuntimeException(\"Can't register driver!\");\n        }\n    }\n\n    // ~ Constructors\n    // -----------------------------------------------------------\n\n    /**\n     * Construct a new driver and register it with DriverManager\n     * \n     * @throws SQLException\n     *             if a database error occurs.\n     */\n    public Driver() throws SQLException {\n        // Required for Class.forName().newInstance()\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä¸‹é¢å†æ¥çœ‹ä¸€ä¸‹ DriverManager ä¸­çš„ registerDriver() æ–¹æ³•ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epublic class DriverManager {\n\n    // DriverManager ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Driver åˆ—è¡¨\n    // æ­¤å¤„çš„ DriverInfo é‡Œé¢å³åŒ…è£…äº† Driver \n    private final static CopyOnWriteArrayList\u0026#x3C;DriverInfo\u003e registeredDrivers = \n        new CopyOnWriteArrayList\u0026#x3C;\u003e();\n\n    // åœ¨ DriverManager ä¸­æ³¨å†Œ Driver\n    public static synchronized void registerDriver(java.sql.Driver driver)\n        throws SQLException {\n        registerDriver(driver, null);\n    }\n  \n    public static synchronized void registerDriver(java.sql.Driver driver,\n            DriverAction da)\n        throws SQLException {\n\n        /* å¦‚æœå½“å‰ Driver ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œå³æ·»åŠ åˆ°åˆ—è¡¨ã€‚ */\n        if(driver != null) {\n            registeredDrivers.addIfAbsent(new DriverInfo(driver, da));\n        } else {\n            // This is for compatibility with the original DriverManager\n            throw new NullPointerException();\n        }\n\n        println(\"registerDriver: \" + driver);\n\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eé€šè¿‡ DriverManager è·å–è¿æ¥(Connection)\u003c/h3\u003e\n\u003cp\u003eä¸Šä¸€èŠ‚æœ‰æåˆ°è¿‡å¯ä»¥é€šè¿‡ DriverManager æ¥éå†è·å–è¿æ¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å£°æ˜å…·ä½“ Driver å¹¶è·å–è¿æ¥ã€‚ä¸‹é¢ä»£ç å±•ç¤ºçš„æ˜¯é€šè¿‡ DriverManager è·å–è¿æ¥çš„æ“ä½œã€‚ \u003cdel\u003eå“ˆå“ˆå“ˆï¼Œåæ­£æœ€åéƒ½æ˜¯ç”±å…·ä½“é©±åŠ¨å®ç°è·å–è¿æ¥ã€‚\u003c/del\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epublic class DriverManager {\n    // è·å–è¿æ¥çš„ public æ¥å£ (1)\n    public static Connection getConnection(String url,\n        java.util.Properties info) throws SQLException {\n        return (getConnection(url, info, Reflection.getCallerClass()));\n    }\n    // è·å–è¿æ¥çš„ public æ¥å£ (2)\n    public static Connection getConnection(String url,\n        String user, String password) throws SQLException {\n        java.util.Properties info = new java.util.Properties();\n\n        if (user != null) {\n            info.put(\"user\", user);\n        }\n        if (password != null) {\n            info.put(\"password\", password);\n        }\n\n        return (getConnection(url, info, Reflection.getCallerClass()));\n    }\n    // è·å–è¿æ¥çš„ public æ¥å£ (3)\n    public static Connection getConnection(String url)\n        throws SQLException {\n        java.util.Properties info = new java.util.Properties();\n        return (getConnection(url, info, Reflection.getCallerClass()));\n    }\n \n    // è·å–è¿æ¥çš„å†…éƒ¨é€»è¾‘å®ç°\n    private static Connection getConnection(\n        String url, java.util.Properties info, Class\u0026#x3C;?\u003e caller) \n        throws SQLException {\n        /*\n         * When callerCl is null, we should check the application's\n         * (which is invoking this class indirectly)\n         * classloader, so that the JDBC driver class outside rt.jar\n         * can be loaded from here.\n         */\n        ClassLoader callerCL = caller != null ? caller.getClassLoader() : null;\n        synchronized(DriverManager.class) {\n            // synchronize loading of the correct classloader.\n            if (callerCL == null) {\n                callerCL = Thread.currentThread().getContextClassLoader();\n            }\n        }\n        // url æ˜¯å®šä½ DBMS æœ€é‡è¦çš„å‚æ•°ï¼Œä¸èƒ½ä¸ºç©º\n        if(url == null) {\n            throw new SQLException(\"The url cannot be null\", \"08001\");\n        }\n\n        println(\"DriverManager.getConnection(\\\"\" + url + \"\\\")\");\n\n        // éå†æ‰€æœ‰æ³¨å†Œçš„ Driver ï¼Œå¹¶éƒ½å°è¯•è·å–è¿æ¥(Connection)\n        SQLException reason = null;\n\n        for(DriverInfo aDriver : registeredDrivers) {\n            // åˆ¤æ–­æ³¨å†Œçš„ Driver æ˜¯å¦ç”± ClassLoader callerCL åŠ è½½ï¼Œä¸æ˜¯åˆ™è·³è¿‡\n            if(isDriverAllowed(aDriver.driver, callerCL)) {\n                try {\n                    println(\"    trying \" + aDriver.driver.getClass().getName());\n                    // è·å–è¿æ¥ï¼Œ:) è¿˜æ˜¯ç”± driver å®ä¾‹è‡ªè¡Œæä¾›\n                    Connection con = aDriver.driver.connect(url, info);\n                    if (con != null) {\n                        // Success!\n                        println(\"getConnection returning \" + \n                                aDriver.driver.getClass().getName());\n                        return (con);\n                    }\n                } catch (SQLException ex) {\n                    if (reason == null) {\n                        reason = ex;\n                    }\n                }\n\n            } else {\n                println(\"    skipping: \" + aDriver.getClass().getName());\n            }\n\n        }\n\n        // å¦‚æœè¿è¡Œåˆ°ä¸‹åˆ—ä»£ç ï¼Œåˆ™è¡¨æ˜è·å–è¿æ¥å¤±è´¥ï¼ŒæŠ›å‡ºé”™è¯¯\n        if (reason != null)    {\n            println(\"getConnection failed: \" + reason);\n            throw reason;\n        }\n\n        println(\"getConnection: no suitable driver found for \"+ url);\n        throw new SQLException(\"No suitable driver found for \"+ url, \"08001\");\n    }\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cem\u003eç®€å•çš„æä¸€å˜´ï¼ŒConnection ä»ç„¶åªæ˜¯ä¸€ä¸ªé’ˆå¯¹ Java -\u003e DB Server çš„ä¸Šå±‚æ¥å£ï¼Œå¦‚æœæƒ³è¦æ›´æ·±å±‚æ¬¡åœ°äº†è§£ Connection ä¸ DB Server çš„äº¤äº’ï¼Œå¯ä»¥å°è¯•å»çœ‹ä¸€ä¸‹ com.mysql.jdbc.MysqlIO ç±»ï¼ŒMySQL å®ç°çš„ JDBC4Connection ç±»ä¹Ÿæ˜¯åœ¨ä½¿ç”¨è¯¥ç±»æ¥å®ç°å¯¹ DB Server äº¤äº’ã€‚ï¼ˆå“ˆå“ˆï¼Œåªçœ‹è¿‡ MySQL æä¾›çš„ Driver åŒ…ï¼‰ã€‚\u003c/em\u003e\u003c/p\u003e\n\u003ch2\u003ePreparedStatement \u0026#x26; CallableStatement\u003c/h2\u003e\n\u003cp\u003eåœ¨äº†è§£äº† DataSource è·å–è¿æ¥(Connection) çš„å®è´¨ä»¥åŠ JdbcTemplate çš„é€šç”¨æ¥å£ä¹‹åï¼Œä½¿ç”¨ Spring-jdbc è¿›è¡Œæ•°æ®åº“ç›¸å…³çš„æ“ä½œå¯ä»¥ç›´æˆªäº†å½“çš„åˆ©ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œå®ç°ï¼ˆæ­¤å¤„ä»…å±•ç¤ºé€šè¿‡ Java ç¡¬ç¼–ç çš„å½¢å¼è¿›è¡Œå®ç°ï¼ŒXML é…ç½®æ–¹æ³•ç±»ä¼¼ï¼‰ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epublic static void main(String... args) {\n    // å®šä¹‰æ•°æ®æº\n    DriverManagerDataSource dataSource = new DriverManagerDataSource();\n    // é…ç½®å‚æ•°\n    dataSource.setUrl(\"jdbc:mysql://\u0026#x3C;host\u003e:\u0026#x3C;port\u003e/\u0026#x3C;dbName\u003e?\u0026#x3C;props\u003e\");\n    dataSource.setUsername(\"\u0026#x3C;username\u003e\");\n    dataSource.setPassword(\"\u0026#x3C;passwd\u003e\");\n    \n    // å®ä¾‹åŒ–ä¸€ä¸ª JDBC å·¥å…·ç±»\n    JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);\n    // æ‰§è¡Œç›¸å…³ CRUD æ“ä½œ \n    jdbcTemplate.execute();\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå›é¡¾ç¬¬ä¸€èŠ‚æ‰€è®²çš„ JdbcTemplate çš„ 4 ä¸ªåŸºç¡€æ–¹æ³•ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003e\u0026#x3C;T\u003e T execute(ConnectionCallback\u0026#x3C;T\u003e action);\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\u0026#x3C;T\u003e T execute(StatementCallback\u0026#x3C;T\u003e action);\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\u0026#x3C;T\u003e T execute(PreparedStatementCreator psc, PreparedStatementCallback\u0026#x3C;T\u003e action);\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\u0026#x3C;T\u003e T execute(CallableStatementCreator csc, CallableStatementCallback\u0026#x3C;T\u003e action);\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://ws1.sinaimg.cn/large/006tKfTcgy1fndsm5tl7aj30zg0byq47.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003eå››ä¸ªåŸºç¡€æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„å›è°ƒå‡½æ•°å°†é€šè¿‡é¢„é…ç½®çš„ DataSource å¾—åˆ°çš„ Connection æˆ– æ›´è¿›ä¸€æ­¥çš„ Statement or PreparedStatement or CallableStatement ä½œä¸ºå…¥å‚æ¥æ‰§è¡Œå®šä¹‰çš„å”¯ä¸€æ–¹æ³•ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ \u003ccode\u003e\u0026#x3C;T\u003e T execute(StatementCallback\u0026#x3C;T\u003e action);\u003c/code\u003e ä¸ºä¾‹æ¥äº†è§£ä¸€ä¸‹æ–¹æ³•çš„æ ¸å¿ƒé€»è¾‘ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epublic \u0026#x3C;T\u003e T execute(StatementCallback\u0026#x3C;T\u003e action) throws DataAccessException {\n    // é€šè¿‡å·¥å…·ç±» DataSourceUtils è·å–ä¸€ä¸ªè¿æ¥\n    Connection con = DataSourceUtils.getConnection(obtainDataSource());\n    // ä¸€ä¸ª Statement ç©ºå®ä¾‹ï¼ŒPreparedStatement, CallableStatement ç±»ä¼¼\n    Statement stmt = null;\n    try {\n        stmt = con.createStatement();   // é€šè¿‡è¿æ¥(Connection)è·å–ä¸€ä¸ª Statement\n        applyStatementSettings(stmt);   // é…ç½® Statement å‚æ•°\n        // å›è°ƒæ‰§è¡Œ doInXXX() æ–¹æ³•, å¹¶è·å¾— result\n        T result = action.doInStatement(stmt);  \n        handleWarnings(stmt);\n        return result;\n    } catch() {\n      \n    } finally {\n      \n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä½†æ˜¯ï¼Œå¯¹äº PreparedStatement å’Œ CallableStatement è€Œè¨€ï¼Œè·å–ä¸€ä¸ª \u003cem\u003eXXX\u003c/em\u003eStatement çš„æ–¹å¼å°±æœ‰æ‰€ä¸åŒäº†ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e// è·å– Statement å®ä¾‹\nStatement stmt = con.createStatement();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e// è·å– PreparedStatement å®ä¾‹\n// psc æ˜¯ä¸€ä¸ª PreparedStatementCreator æ¥å£å®ç°çš„å®ä¾‹\nPreparedStatement ps = psc.createPreparedStatement(con);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e// è·å– CallableStatement å®ä¾‹\n// csc æ˜¯ä¸€ä¸ª CallableStatementCreator æ¥å£å®ç°çš„å®ä¾‹\nCallableStatement cs = csc.createCallableStatement(con);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå¯ä»¥çœ‹åˆ° Statement ç›´æ¥é€šè¿‡ Connection è·å–å®ä¾‹ï¼Œä½†æ˜¯ PreparedStatement å’Œ CallableStatement å°±æœ‰æ‰€ä¸åŒï¼Œå…¶åŒºåˆ«å°±åœ¨äº PreparedStatement å’Œ CallableStatement ä¸¤ä¸ª Statement éƒ½æ˜¯å¯ä»¥å®šåˆ¶å…¥å‚çš„ï¼Œæ›´ç”šè€…ï¼Œ CallableStatement å¯ä»¥å®šåˆ¶ DB æ‰§è¡Œç»“æœçš„å‡ºå‚ã€‚å½“ç„¶ï¼Œæ ¸å¿ƒè¿˜æ˜¯ \u003ccode\u003econ.prepareStatement() OR con.prepareCall()\u003c/code\u003e æ–¹æ³•ï¼Œåªä¸è¿‡æ˜¯å°†è·å– XXXStatement çš„æ“ä½œä¸‹æ”¾ç»™ XXXStatementCreator å®ä¾‹ç±»å®ç°ï¼Œç»™äºˆä½¿ç”¨è€…é‡å¤çš„è‡ªä¸»æƒï¼ŒåŒæ—¶ä¹Ÿæ˜¯é€»è¾‘è§£è€¦çš„ä¸€ç§æ“ä½œã€‚\u003c/p\u003e\n\u003cp\u003eä¾‹å¦‚ï¼š\u003c/p\u003e\n\u003cp\u003eSimplePreparedStatementCreator è¿™ä¸ª PreparedStatementCreator æ¥å£çš„å®ç°ç±»ï¼Œåªæ˜¯ç®€å•çš„è°ƒç”¨äº† \u003ccode\u003econ.prepareStatement(sql)\u003c/code\u003e æ–¹æ³•ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003eprivate static class SimplePreparedStatementCreator \n    implements PreparedStatementCreator, SqlProvider {\n\n    private final String sql;\n\n    @Override\n    public PreparedStatement createPreparedStatement(Connection con) \n        throws SQLException {\n        return con.prepareStatement(this.sql);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eè€Œå¯¹äº PreparedStatementCreatorImpl ï¼Œåœ¨ createPreparedStatement(Connection con) çš„å®ç°ä¸Šï¼Œåˆæ·»åŠ äº†æ›´å¤šçš„æ“ä½œã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003eprivate class PreparedStatementCreatorImpl\n        implements PreparedStatementCreator, PreparedStatementSetter, SqlProvider, ParameterDisposer {\n\n    private final String actualSql;\n\n    private final List\u0026#x3C;?\u003e parameters;\n\n    @Override\n    public PreparedStatement createPreparedStatement(Connection con) throws SQLException {\n        PreparedStatement ps;\n        if (generatedKeysColumnNames != null || returnGeneratedKeys) {\n            if (generatedKeysColumnNames != null) {\n                // è·å–ä¸€ä¸ª PreparedStatement å®ä¾‹ï¼Œä¸‹åŒ\n                ps = con.prepareStatement(this.actualSql, \n                                          generatedKeysColumnNames);\n            }\n            else {\n                ps = con.prepareStatement(this.actualSql, \n                                         PreparedStatement.RETURN_GENERATED_KEYS);\n            }\n        }\n        else if (resultSetType == ResultSet.TYPE_FORWARD_ONLY \n                 \u0026#x26;\u0026#x26; !updatableResults) {\n            ps = con.prepareStatement(this.actualSql);\n        }\n        else {\n            ps = con.prepareStatement(this.actualSql, resultSetType,\n                updatableResults ? ResultSet.CONCUR_UPDATABLE : \n                                      ResultSet.CONCUR_READ_ONLY);\n        }\n        // å°†å¯å˜ SQL (ä¾‹å¦‚ SELECT * FROM msg WHERE id = ?) çš„ ? ç”¨å®é™…å‚æ•°æ›¿æ¢\n        setValues(ps);\n        return ps;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä»ä¸Šè¿°ä¸¤ç§ PreparedStatementCreator æ¥å£çš„ä¸åŒå®ç°ï¼Œä¹Ÿå¯ä»¥ä»å¦ä¸€ç§è§’åº¦ç†è§£åˆ°ï¼Œå‡½æ•°å¼æ¥å£å°†è·å–ç›®æ ‡å‡ºå‚çš„å…·ä½“é€»è¾‘äº¤ç»™ä½¿ç”¨è€…å®šä¹‰ï¼Œç»™äºˆäº†ä½¿ç”¨è€…å……åˆ†çš„è‡ªä¸»æƒï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ç§ä¸šåŠ¡é€»è¾‘çš„è§£è€¦ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ä¸Šé¢ä»£ç  PreparedStatementCreatorImpl ç±»çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ç¬¬ 32 è¡Œä»£ç  \u003ccode\u003esetValue(ps)\u003c/code\u003e ã€‚æ­¤å¤„çš„æ–¹æ³•æ˜¯ç”±æ¥å£ PreparedStatementSetter å®šä¹‰çš„ã€‚ä¸»è¦ç›®çš„æ˜¯å°†å¯å˜ SQL ä¸­çš„ ? å‚æ•°ç”¨å®é™…å‚æ•°è¿›è¡Œä¸€ä¸ªæ›¿æ¢ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e// ä»¥ SQL (SELECT * FROM msg WHERE id = ? AND day = ?) ä¸ºä¾‹\n/** çº¯ Java æ ¸å¿ƒåº“çš„å®ç° PreparedStatement å‚æ•°æ³¨å…¥ */\nps.setInt(1, 1763);\nps.setString(2, \"2018-01-01\");\nps.executeQuery();\n\n/** ä»¥ Spring-jdbc å®ç° PreparedStatement å‚æ•°æ³¨å…¥ */\n// setValues() ç”±æ¥å£ PreparedStatementSetter å®šä¹‰ï¼Œå°è£…äº†æ³¨å…¥å‚æ•°çš„å…·ä½“å®ç°é€»è¾‘\n// å¯ä»¥ç”±ä½¿ç”¨è€…è‡ªè¡Œå®šä¹‰\nsetValues(ps);  \nps.executeQuery();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"https://ws1.sinaimg.cn/large/006tKfTcgy1fndyybh4q1j31kw0u3afx.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸Šé¢ç±»å›¾è¡¨ç¤ºäº† PreparedStatementSetter åŠå…¶å®ç°ç±»çš„ç›¸å…³ä¾èµ–ã€‚\u003c/p\u003e\n\u003cp\u003eSetter çš„ä¸»è¦ç›®æ ‡å³ä¸ºå¯¹ SQL ä¸­çš„ ? å‚æ•°è¿›è¡Œæ³¨å…¥ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cdel\u003eä¸ªäººç²¾åŠ›æœ‰é™ï¼Œå¯¹Spring-jdbcåœ¨Statementä¸Šå¯¹å‚æ•°æ³¨å…¥çš„å›è°ƒç†è§£æœ‰é™ã€‚\u003c/del\u003e\u003c/p\u003e\n\u003ch2\u003eResultSet\u003c/h2\u003e\n\u003cp\u003eåœ¨å‰å‡ èŠ‚å·²ç»æåˆ°è®²äº†æ•°æ®æºã€é©±åŠ¨ç®¡ç†å™¨ä»¥åŠ Statement ä¹‹åï¼Œåˆ©ç”¨ JDBC çš„æœ€é‡è¦çš„ç›®çš„å°±æ˜¯å¯¹ DB è¿›è¡Œæ“ä½œï¼Œå¹¶è·å¾—é¢„æœŸç»“æœã€‚å¯¹äºæŸ¥è¯¢è¯­å¥è€Œè¨€ï¼Œç»“æœåº”è¯¥æ˜¯è‹¥å¹²è®°å½•è¡Œï¼›å°±æ›´æ–°è¯­å¥è€Œè¨€ï¼Œç»“æœå¯èƒ½æ˜¯å½±å“çš„è¡Œæ•°ã€‚è€Œ Spring-jdbc å¯¹ ResultSet é¢å¤–è¿›è¡Œçš„å°è£…ï¼Œå³æ˜¯å°†åŸæœ¬æ•£ä¹±çš„ç»“æœè¿›è¡Œä¸€ä¸ªæ•´åˆï¼Œä¾‹å¦‚æ•´åˆæˆä¸€ä¸ª(ä¸€ç»„)å®Œæ•´çš„ Bean æ¥è¿›è¡Œå±•ç¤ºã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ JdbcTemplate ä¸­ï¼Œå››ä¸ªåŸºæœ¬æ–¹æ³•å…¥å‚éƒ½åŒ…æ‹¬ä¸€ä¸ªå›è°ƒæ¥å£ï¼Œè€Œåœ¨æ‰§è¡Œå›è°ƒè·å¾— ResultSet ä¹‹åï¼Œæ–¹æ³•å¹¶ä¸æ˜¯ç›´æ¥è¿”å›ï¼Œè€Œæ˜¯è¿›è¡Œäº†ä¸€å®šçš„æ“ä½œã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ä¸€ä¸ª PreparedStatementCallback çš„å®ä¾‹ç±»ä¸ºä¾‹ï¼Œåœ¨ doInPreparedStatement() æ–¹æ³•ä¸­ï¼Œè·å¾—äº† ResultSet ï¼Œä½†æ˜¯ä»é€šè¿‡ rse.extractData(rs) è¯­å¥è¿›è¡Œäº†å¤„ç†åå†è¿”å›ç»“æœ\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epublic T doInPreparedStatement(PreparedStatement ps) throws SQLException {\n    // å£°æ˜ä¸€ä¸ª ResultSet \n    ResultSet rs = null;\n    try {\n        if (pss != null) {  // setValues() æ–¹æ³•å¡«å…… PreparedStatement ä¸­çš„å¯å˜å‚æ•° ? \n            pss.setValues(ps);\n        }\n        rs = ps.executeQuery(); // æ‰§è¡ŒæŸ¥è¯¢ sql ï¼Œè·å–ç»“æœ\n        return rse.extractData(rs); // é‡ç‚¹... è¯¥è¯­å¥ä¸€å®šæ˜¯å¯¹ç»“æœè¿›è¡Œäº†ä¸€äº›æ“ä½œ.\n    }\n    finally {\n        JdbcUtils.closeResultSet(rs);\n        if (pss instanceof ParameterDisposer) {\n            ((ParameterDisposer) pss).cleanupParameters();\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eåœ¨æ¥çœ‹ä¸€ä¸‹ç©¶ç«Ÿåœ¨è¿”å›ç»“æœå‰è¿›è¡Œäº†ä»€ä¹ˆæ“ä½œã€‚\u003c/p\u003e\n\u003cp\u003eç”±äºæ˜¯ä¸€ä¸ªå›è°ƒæ¥å£çš„å®ç°ç±»ï¼Œrse åº”è¯¥åœ¨å¤–éƒ¨æ–¹æ³•ä¸­ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epublic \u0026#x3C;T\u003e T query(\n        PreparedStatementCreator psc, @Nullable final PreparedStatementSetter pss, \n        final ResultSetExtractor\u0026#x3C;T\u003e rse)\n        throws DataAccessException {\n\n    return execute(psc, new PreparedStatementCallback\u0026#x3C;T\u003e() {\n        @Override\n        public T doInPreparedStatement(PreparedStatement ps) throws SQLException {\n            ... \n        }\n    });\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå¯ä»¥çœ‹åˆ° rse æ˜¯ä¸€ä¸ª ResultSetExtractor çš„å®ä¾‹ã€‚ä»åç§°ä¸Šå¯ä»¥çœ‹å‡º Extractor å³ä¸ºæå–å™¨ï¼Œç»“æœé›†æå–å™¨ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e/** å‡½æ•°å¼æ¥å£ï¼Œæä¾›çš„å”¯ä¸€æ–¹æ³•ä¸º extractData(...) */\n@FunctionalInterface\npublic interface ResultSetExtractor\u0026#x3C;T\u003e {\n\n    @Nullable\n    T extractData(ResultSet rs) throws SQLException, DataAccessException;\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"https://ws3.sinaimg.cn/large/006tKfTcgy1fndzz0pqnrj31a60i676v.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003eSpring-jdbc ä¸­ç°æœ‰çš„å®ç°æœ‰ä¸‰ä¸ªç±»ï¼Œå…¶ä¸­ RowCallbackHandlerResultSetExtractor å’Œ RowMapperResultSetExtractor ä¸¤ä¸ªç±»ä»ä¸Šé¢ç±»å›¾åŠå‘½åå³å¯çœ‹å‡ºï¼Œä¸¤ä¸ªæ˜¯ä½œä¸ºä¸€ä¸ªé€‚é…å™¨è€Œå­˜åœ¨çš„ï¼Œå°† extractData() è¿›è¡Œè½¬æ¢ï¼Œåˆ†åˆ«ç”± RowCallbackHandler å’Œ RowMapper å®ä¾‹è¿›è¡Œå…·ä½“æ“ä½œã€‚è€Œ AbstractLobStreamingResultSetExtractor ç±»ä»åç§°ä¸Šçœ‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç±»ä¼¼æµæ“ä½œçš„å®ç°ç±»(å…¶ä¸­çš„ Lob æŒ‡çš„æ˜¯ DB ä¸­çš„ BLOB ä¸ CLOB ç±»å‹ï¼Œåœ¨ Spring-jdbc ä¸­ä¹ŸåŠ å…¥äº†é¢å¤–çš„æ”¯æŒ) ã€‚\u003c/p\u003e\n\u003ch3\u003eRowCallbackHandler\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://ws3.sinaimg.cn/large/006tKfTcgy1fnh2uw3a0aj30h20jeta4.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003eä»åç§°ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ ResultSet ç»“æœé›†è¡Œç›¸å…³çš„å›è°ƒæ¥å£ã€‚processRow(ResultSet rs) æ–¹æ³•å°†å¤„ç†è¡Œç›¸å…³çš„é€»è¾‘ã€‚\u003c/p\u003e\n\u003cp\u003eä»å®ƒçš„ä¸€ä¸ªå®ç°ç±» RowCountCallbackHandler æ¥è¯´ï¼Œå…¶æœ€ä¸»è¦çš„ç§æœ‰å±æ€§ rowCount å³æ˜¯ç»Ÿè®¡ ResultSet çš„ç»“æœè¡Œæ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“ä½¿ç”¨çš„è¯¥ç±»çš„æ¡ˆä¾‹ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epublic static void main(String[] args) throws ClassNotFoundException {\n\n    DriverManagerDataSource dataSource = new DriverManagerDataSource();\n    dataSource.setUrl(\"jdbc:mysql://\u0026#x3C;host\u003e:\u0026#x3C;port\u003e/\u0026#x3C;dbName\u003e\");\n    dataSource.setUsername(\"\u0026#x3C;username\u003e\");\n    dataSource.setPassword(\"\u0026#x3C;password\u003e\");\n\n    JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);\n    RowCountCallbackHandler rcch = new RowCountCallbackHandler();\n\n    jdbcTemplate.query(\"SELECT * FROM info WHERE id='2018'\", (RowCallbackHandler) rcch);\n    \n    System.out.println(rcch.getRowCount()); //è·å–ç»“æœé›†è¡Œæ•°\n    System.out.println(rcch.getColumnCount());  // è·å–ç»“æœé›†åˆ—æ•°\n    for (String arg : rcch.getColumnNames()) {  // æ‰“å°ç»“æœé›†æ¯ä¸€åˆ—åç§°\n        System.out.println(\"ColumnNames : \" + arg);\n    }\n    for (int i : rcch.getColumnTypes()) {   // æ‰“å°ç»“æœé›†æ¯ä¸€åˆ—ç±»å‹(Types ä¸ºæšä¸¾ç±»)\n        System.out.println(\"ColumnTypes : \" + i);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå…·ä½“æŸ¥çœ‹ RowCountCallbackHandler ç±»çš„ processRow() æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œå…¶è·å–åˆ—ç›¸å…³ä¿¡æ¯éƒ½æ¥è‡ªäº ResultSetMetaData ã€‚è€Œç»“æœè¡Œæ•°æ¥æºäº Iterator è¿­ä»£ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e@Override\npublic final void processRow(ResultSet rs) throws SQLException {\n    if (this.rowCount == 0) {\n        ResultSetMetaData rsmd = rs.getMetaData();\n        this.columnCount = rsmd.getColumnCount();\n        this.columnTypes = new int[this.columnCount];\n        this.columnNames = new String[this.columnCount];\n        for (int i = 0; i \u0026#x3C; this.columnCount; i++) {\n            this.columnTypes[i] = rsmd.getColumnType(i + 1);\n            this.columnNames[i] = JdbcUtils.lookupColumnName(rsmd, i + 1);\n        }\n        // could also get column names\n    }\n    processRow(rs, this.rowCount++);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eRowMapper\u003c/h3\u003e\n\u003cp\u003eä¸Šé¢ RowCallbackHandler æ¥å£ä»é€»è¾‘ä¸Šåˆ’åˆ†æ˜¯ç”¨äºå¤„ç† ResultSet å…ƒæ•°æ®ä¿¡æ¯çš„ã€‚è€Œ RowMapper è¾ƒä¸Šä¸€ä¸ªæ¥å£è€Œè¨€ï¼Œæœ‰æ›´é«˜çš„å®ç”¨æ€§ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://ws3.sinaimg.cn/large/006tKfTcgy1fnh3h739kaj30z60nago4.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003eç‰¹åˆ«æ˜¯å…¶å®ç°ç±» BeanPropertyRowMapper å¯ä»¥å°†æ•£ä¹±çš„ ResultSet çš„ç»“æœæ•°æ®æ•´ç†æˆä¸€ä¸ªä¸ª Object Bean ä½œä¸ºè¿”å›ç»“æœã€‚è€Œçœå»äº†å¯¹é€ä¸€è¯»å– ResultSet è¡Œè®°å½•å¹¶å¡«å…… Bean å±æ€§çš„éº»çƒ¦ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003eJdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);\n\nBeanPropertyRowMapper\u0026#x3C;Model\u003e rowMapper = new BeanPropertyRowMapper\u0026#x3C;\u003e(Model.class);\nList\u0026#x3C;Model\u003e list = jdbcTemplate.query(\"SELECT * FROM info WHERE id = '2018'\", rowMapper);\n/** è·å¾—çš„ Model list çš„å¯¹åº”å±æ€§å°†é€šè¿‡ Java çš„åå°„æœºåˆ¶è¿›è¡Œå¡«å……\n *  List\u0026#x3C;Model\u003e list å³ç»“æœ\n */\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå½“ç„¶ï¼Œè¦æ±‚æ˜¯ Model ç±»ä¸­çš„å±æ€§ä¸ DB table ä¸­çš„åˆ—åä¿æŒä¸€è‡´ï¼ˆå¤§å°å†™æ— è¦æ±‚ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003eè€Œå…¶å®ƒä¸¤ä¸ªç±»çš„å®ç°ä¹Ÿæ˜¯åŸºäºåå°„æœºåˆ¶ï¼Œå®ç°å…¶ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-text\"\u003e  __                    __                  \n / _| __ _ _ __   __ _ / _| ___ _ __   __ _ \n| |_ / _` | '_ \\ / _` | |_ / _ \\ '_ \\ / _` |\n|  _| (_| | | | | (_| |  _|  __/ | | | (_| |\n|_|  \\__,_|_| |_|\\__, |_|  \\___|_| |_|\\__, |\n                 |___/                |___/ \n\u003c/code\u003e\u003c/pre\u003e","digest":"\u003ch2\u003eæ¦‚è§ˆ\u003c/h2\u003e\n\u003cp\u003eåœ¨å­¦ä¹  Spring-JDBC ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦ä» Java åŸç”Ÿæä¾›çš„ JDBC å¼€å§‹ï¼Œå¯¹ JDBC æ“ä½œçš„ä¸€æ•´å¥—å®Œæ•´çš„æµç¨‹æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¦‚å¿µã€‚\u003c/p\u003e"}],"items":32,"pages":4,"currentPage":3},"buildId":"YsOqVyLvFnUbWFBFmGa7N","dynamicBuildId":false,"assetPrefix":"https://www.ffutop.com/blog","nextExport":true}</script><script async="" id="__NEXT_PAGE__/" src="https://www.ffutop.com/blog/_next/static/YsOqVyLvFnUbWFBFmGa7N/pages/index.js"></script><script async="" id="__NEXT_PAGE__/_app" src="https://www.ffutop.com/blog/_next/static/YsOqVyLvFnUbWFBFmGa7N/pages/_app.js"></script><script src="https://www.ffutop.com/blog/_next/static/runtime/webpack-8ed9452df514b4d17d80.js" async=""></script><script src="https://www.ffutop.com/blog/_next/static/chunks/commons.ca07934498d0c5523bf5.js" async=""></script><script src="https://www.ffutop.com/blog/_next/static/chunks/styles.74c43a0e96cfe845a889.js" async=""></script><script src="https://www.ffutop.com/blog/_next/static/runtime/main-3daabeb1dde7624c7fe0.js" async=""></script></body></html>